# 元数据分析

**状态**: ✅ 已解决
**最后更新**: 2026-01-29

---

## 元数据字节位置功能

| 位置 | 已知功能 | 状态 |
|------|----------|------|
| [0] | Bit 7-4: 编码类型标志 | ✅ 已解决 |
| [0] | Bit 3-0: 未使用 | ✅ 已确认 |
| [1] | 未使用 | ✅ 已确认 |
| [2] | 未使用 | ✅ 已解决 (代码搜索: 0 条访问指令) |
| [3] | 未使用 | ✅ 已确认 |
| [4] | 未使用 | ✅ 已解决 (代码搜索: 0 条访问指令) |
| [5] | 未使用 | ✅ 已解决 (代码搜索: 0 条访问指令) |

---

## metadata[0] 完整分析

### Bit 7-4: 编码类型标志 ✅

```
encoding = (metadata[0] >> 4) >= 0x8 ? 特殊编码 : 标准编码
```

| metadata[0] 高4位 | 编码类型 | 列数 |
|------------------|----------|------|
| 0x0-0x7 | 标准 | 15 |
| 0x8-0xF | 特殊 | 14 |

### Bit 3-0: 不被使用 ✅

**关键发现**: metadata[0] Bit 3-0 **不被渲染代码使用**。

---

## metadata[2], [4], [5] 分析结果 ✅ (2026-01-29)

### 基于反汇编代码搜索的结论

**方法**: 使用 Capstone 反汇编引擎搜索整个固件（0x1000 - 0x2000000）

**搜索目标**: ldrb/ldrh/ldr/ldrsb/ldrhsh/strb/strh/str [reg, #offset]
**目标偏移**: #2, #4, #5

**搜索结果**:

```
### 偏移量 2 (metadata[2]) ###
  ❌ 没有找到任何访问此偏移量的指令

### 偏移量 4 (metadata[4]) ###
  ❌ 没有找到任何访问此偏移量的指令

### 偏移量 5 (metadata[5]) ###
  ❌ 没有找到任何访问此偏移量的指令
```

**结论**: metadata[2], [4], [5] **完全未被使用**。

### 渲染代码证据

```assembly
0x02DB58:  ldrh r2, [r6, #6]    ; 从 r6+6 加载16位数据
                               ; 跳过了前6字节 metadata[0-5]
```

这确认了渲染代码直接从 `r6 + 6` 开始读取像素数据。

---

## 代码搜索证据

**使用脚本**: `search_metadata_exact.py`

```bash
$ python3 search_metadata_exact.py

### 偏移量 2 (metadata[2]) ###
  ❌ 没有找到任何访问此偏移量的指令

### 偏移量 4 (metadata[4]) ###
  ❌ 没有找到任何访问此偏移量的指令

### 偏移量 5 (metadata[5]) ###
  ❌ 没有找到任何访问此偏移量的指令
```

---

## 重要发现

### metadata[0-5] 不被渲染代码直接访问 ✅

**发现**: 搜索整个渲染函数，唯一访问 r6 的指令是 `ldrh r2, [r6, #6]`。

这跳过了全部 6 字节 metadata。

**结论**: metadata[2], [4], [5] 在渲染时不被读取，是遗留数据。

---

**参见**:
- [metadata[2][4][5] 最终分析](./METADATA_2_4_5_ANALYSIS_FINAL.md)
- [编码规则](./ENCODING_RULES.md)
- [数据结构定义](../02_ARCHITECTURE/DATA_STRUCTURES.md)
