# 元数据分析

**状态**: ⚠️ 部分已知
**最后更新**: 2026-01-28

---

## 元数据字节位置功能

| 位置 | 已知功能 | 状态 |
|------|----------|------|
| [0] | Bit 7-4: 编码类型标志 | ✅ 已解决 |
| [0] | Bit 3-0: 未知（不被使用） | ✅ 已确认 |
| [1], [3] | 像素数据的一部分 | ✅ 已确认 |
| [2], [4], [5] | 未知 | ❓ 待分析 |

---

## metadata[0] 完整分析

### Bit 7-4: 编码类型标志 ✅

```
encoding = (metadata[0] >> 4) >= 0x8 ? 特殊编码 : 标准编码
```

| metadata[0] 高4位 | 编码类型 | 列数 |
|------------------|----------|------|
| 0x0-0x7 | 标准 | 15 |
| 0x8-0xF | 特殊 | 14 |

### Bit 3-0: 不被使用 ✅

**关键发现**: metadata[0] Bit 3-0 **不被渲染代码使用**。

| 字符 | Unicode | 编码类型 | metadata[0] | Bit 3-0 |
|------|---------|----------|-------------|---------|
| 沨 | U+6CA8 | 标准 (15列) | 0x39 | 9 |
| 沤 | U+6CA4 | 标准 (15列) | 0x29 | 9 |
| 沦 | U+6CA6 | 特殊 (14列) | 0xF1 | 1 |
| 沪 | U+6CAA | 标准 (15列) | 0x20 | 0 |

**观察**: Bit 3-0 值 (9, 9, 1, 0) 与列数 (15/14) 无直接对应关系。

---

## 元数据完整对比

```
沨 (U+6CA8, 标准编码):
  metadata[0-5] = 39 96 40 88 47 70
  Bit 7-4 = 3 → 标准编码
  Bit 3-0 = 9 → 未知

沤 (U+6CA4, 标准编码):
  metadata[0-5] = 29 96 dc 03 f1 c1
  Bit 7-4 = 2 → 标准编码
  Bit 3-0 = 9 → 未知

沦 (U+6CA6, 特殊编码):
  metadata[0-5] = f1 c1 01 96 40 c8
  Bit 7-4 = 15 → 特殊编码
  Bit 3-0 = 1 → 未知

沪 (U+6CAA, 标准编码):
  metadata[0-5] = 20 00 47 70 29 96
  Bit 7-4 = 2 → 标准编码
  Bit 3-0 = 0 → 未知
```

---

## 重要发现

### metadata[0-5] 不被渲染代码直接访问 ✅

**发现**: 搜索整个渲染函数，唯一访问 r6 的指令是 `ldrh r2, [r6, #6]`。

这跳过了全部 6 字节 metadata。

**结论**: metadata[2], [4], [5] 在渲染时不被读取。

### 渲染上下文设置位置 ✅

```
0x2D040: str r0, [r5, #4]  ; 这可能是设置渲染上下文[+4]的位置
```

---

## 未解决的问题

| 问题 | 优先级 | 状态 |
|------|--------|------|
| metadata[2] 的功能 | 🟡 中 | ❓ 待分析 |
| metadata[4] 的功能 | 🟡 中 | ❓ 待分析 |
| metadata[5] 的功能 | 🟡 中 | ❓ 待分析 |

---

## metadata[2], [4], [5] 详细分析

### 数据对比

| 字符 | Unicode | 编码 | [2] | [4] | [5] | 有符号[2] | 有符号[4] | 有符号[5] |
|------|---------|------|-----|-----|-----|-----------|-----------|-----------|
| 沨 | U+6CA8 | 标准 | 0x40 | 0x47 | 0x70 | +64 | +71 | +112 |
| 沤 | U+6CA4 | 标准 | 0xDC | 0xF1 | 0xC1 | -36 | -15 | -63 |
| 沦 | U+6CA6 | 特殊 | 0x01 | 0x40 | 0xC8 | +1 | +64 | -56 |
| 沪 | U+6CAA | 标准 | 0x47 | 0x29 | 0x96 | +71 | +41 | -106 |

### 分析结果

**❌ 与像素密度无直接相关性**
- 沨 (密度高): [2]=+64, [4]=+71, [5]=+112
- 沤 (密度低): [2]=-36, [4]=-15, [5]=-63
- 沦 (密度中): [2]=+1, [4]=+64, [5]=-56
- 无明显数值规律

**❌ 值超出合理行/列索引范围**
- 行索引范围: 0-15
- 列索引范围: 0-14 (标准) 或 0-13 (特殊)
- 但 [2], [4], [5] 的值包括: +112, -63, -106 等，远超合理范围

**❓ 可能的解释**

| 解释 | 可能性 | 说明 |
|------|--------|------|
| 地址偏移的一部分 | 🟡 中 | 可能与内存地址计算相关 |
| 预处理后的渲染参数 | 🟡 中 | 可能是某种变换参数 |
| 压缩存储的多字段数据 | 🟢 低 | 每字节可能包含多个小字段 |
| 遗留/调试数据 | 🟢 低 | 可能是开发工具留下的 |

**当前结论**: metadata[2], [4], [5] 在**渲染时不被读取**，具体用途待进一步分析。

---

**参见**:
- [编码规则](./ENCODING_RULES.md)
- [数据结构定义](../02_ARCHITECTURE/DATA_STRUCTURES.md)
